services:
  schedule-helper:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        NEXT_PUBLIC_CLIENTVAR: "clientvar"
    working_dir: /app
    ports:
      - 3000:3000
    image: schedule-helper
    container_name: schedule-helper
    environment:
     - DATABASE_URL=${DATABASE_URL}
     - AUTH_SECRET=${AUTH_SECRET}
     - AUTH_TRUST_HOST=true
     - AUTH_GOOGLE_ID=${AUTH_GOOGLE_ID}
     - AUTH_GOOGLE_SECRET=${AUTH_GOOGLE_SECRET}
     - AUTH_URL=${AUTH_URL}
     - PROVIDER_CREDENTIALING_ID=${PROVIDER_CREDENTIALING_ID}
     - PROVIDER_CREDENTIALING_RANGE=${PROVIDER_CREDENTIALING_RANGE}
     - OFFICE_ADDRESSES=${OFFICE_ADDRESSES}
     - ASANA_TOKEN=${ASANA_TOKEN}
     - ASANA_WORKSPACE=${ASANA_WORKSPACE}

  driftwood-db:
    image: mysql
    container_name: driftwood-db
    restart: always
    environment:
      - MYSQL_ROOT_PASSWORD=${MYSQL_ROOT_PASSWORD}
      - MYSQL_DATABASE=${MYSQL_DATABASE}
      - MYSQL_PASSWORD=${MYSQL_PASSWORD}
      - MYSQL_USER=${MYSQL_USER}
    ports:
      - 3306:3306
    volumes:
      - db-data:/var/lib/mysql

  cloudflared:
    image: cloudflare/cloudflared:latest
    container_name: cloudflared
    command: tunnel --no-autoupdate run --token
      ${CF_TOKEN}
    restart: always
    network_mode: host

volumes:
  db-data:
